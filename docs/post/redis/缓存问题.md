---
title: "缓存问题"
date: "2020-12-03"
tag: ["Redis"]
categories: ["Redis"]
draft: true
---
# redis 缓存问题

## 缓存雪崩

        缓存大批量失效（例如热点数据的 key 失效时间都是同一时刻），大量请求直接打到数据库上，数据库扛不住挂了，就算重启数据库，又被新的流量打死。

### 解决

        key 的失效时间加个随机值，或者永不过期，数据更新再刷新缓存。
        setRedis（Key，value，time + Math.random() * 10000）；

## 缓存穿透

        请求的数据在缓存和数据库中都不存在（id -1 或者特别大的id值），大并发请求落到数据库上。

### 解决

    1. 在接口层增加参数验证、用户鉴权、例如 id <= 0 return；
    2. ip 多次请求限制，超过阈值黑名单；
    3. redis 布隆过滤器；

> 引申 分页查询，如果没有对分页参数做限制，查询大页导致数据库慢查询，影响数据库。

## 缓存击穿

        对一个 key 不停的大并发访问，在key失效的瞬间，持续的大并发穿透缓存，直接请求数据库。

### 解决

    1. 热点数据永不过期；
    2. 互斥锁

> 引申
>
> 1. 事前 redis HA、主从+哨兵、Redis cluster 避免曲剧崩溃
> 2. 事后 本地缓存、限流+降级、避免 Mysql 被打死；限流牺牲部分用户体验，保证数据库不死；
