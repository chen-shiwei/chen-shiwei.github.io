---
title: "容器持久化存储"
date: "2020-12-18 14:26:35"
tag: ["Kubernetes"]
categories: ["Kubernetes"]
draft: true
---

## 容器化存储的相关概念

- PV

  - 持久化存储数据卷

  - 这个API对象描述的是一个持久化存储在宿主机上的目录，比如一个NFS挂载目录

  - ```yaml
    # nfs 的pv
    apiVersion: v1
    kind: PersistentVolume
    metadata:
      name: nfs
    spec:
      storageClassName: manual
      capacity:
        storage: 1Gi
      accessModes:
        - ReadWriteMany
      nfs:
        server: 10.244.1.4
        path: "/"
    ```

- PVC

  - PVC 描述的是POD所希望使用的持久化存储的属性

    - 比如 volume 的大小、可读写权限等

  - ```yaml
    # PV
    apiVersion: v1
    kind: PersistentVolumeClaim
    metadata:
      name: nfs
    spec:
      accessModes:
        - ReadWriteMany
      storageClassName: manual
      resources:
        requests:
          storage: 1Gi
    ```

- PV和PVC绑定

  - PV和PVC的spec字段，PV的storage大小要满足PVC的要求

  - PV和PVC的storageClassName 字段必须一样

  - ```yaml
    # 在pod使用PVC
    apiVersion: v1
    kind: Pod
    metadata:
      labels:
        role: web-frontend
    spec:
      containers:
      - name: web
        image: nginx
        ports:
          - name: web
            containerPort: 80
        volumeMounts:
            - name: nfs
              mountPath: "/usr/share/nginx/html"
      volumes:
      - name: nfs
        persistentVolumeClaim:
          claimName: nfs
    ```

  - PV和PVC的设计，和面向对象的思想一致

    - PVC可以理解为持久化存储的接口，提供持久化存储的描述，但不提示持久化存储的实现
    - PV是持久化存储的实现
      - 一般是NFS或者ceph
    - 撮合PV和PVC的是的PersistentVolumeController

- StorageClass 

